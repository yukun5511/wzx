<view class="container">
  <view class="card" wx:if="{{activeRole==='student'}}">
    <view class="section-head">
      <view class="title">老师申请</view>
      <view class="status-badge" wx:if="{{myTeacherApplication}}">{{myTeacherApplication.status}}</view>
    </view>
    <view class="desc">提交后由管理员审批，通过后可使用老师工作台。</view>
    <textarea class="mt-12" placeholder="申请理由（选填）" value="{{applyReason}}" bindinput="onReasonInput" />
    <button class="btn-primary" bindtap="submitTeacherApplication">提交申请</button>
    <view class="meta" wx:if="{{myTeacherApplication}}">最近更新时间：{{myTeacherApplication.updatedAt || myTeacherApplication.createdAt}}</view>
  </view>

  <view class="card" wx:if="{{activeRole==='teacher'}}">
    <view class="title">老师工作台</view>
    <view class="desc">管理课程内容、发布作业、批改提交记录。</view>
    <view class="action-group">
      <button class="btn-primary" bindtap="goTeacherWorkbench">进入工作台</button>
      <button class="mt-12" wx:if="{{user.role==='admin'}}" bindtap="switchToAdminManage">切回管理员并查看审批</button>
      <button class="mt-12" bindtap="goSignIn">现场签到入口</button>
    </view>
  </view>

  <view class="card" wx:if="{{activeRole==='admin'}}">
    <view class="title">管理工作台</view>
    <view class="desc">当前为管理员视角，重点处理老师申请审批与管理任务。</view>
    <button class="btn-primary" bindtap="switchToTeacherWorkbench">切换为老师并进入工作台</button>
  </view>

  <view class="card" wx:if="{{activeRole==='admin'}}">
    <view class="section-head">
      <view class="title">审批列表</view>
      <view class="table-count">{{pendingTeacherApplications.length}} 条待处理</view>
    </view>

    <view class="table" wx:if="{{pendingTeacherApplications.length}}">
      <view class="table-head">
        <view class="col applicant">申请人</view>
        <view class="col phone">手机号</view>
        <view class="col time">时间</view>
        <view class="col reason">理由</view>
        <view class="col ops">操作</view>
      </view>

      <view wx:for="{{pendingTeacherApplications}}" wx:key="_id" class="table-row">
        <view class="col applicant">{{item.applicantOpenid}}</view>
        <view class="col phone">{{item.applicantPhone || '-'}}</view>
        <view class="col time">{{item.createdAt}}</view>
        <view class="col reason">{{item.reason || '无'}}</view>
        <view class="col ops">
          <button size="mini" class="btn-primary mini-btn" data-id="{{item._id}}" data-pass="{{true}}" bindtap="reviewTeacherApplication">通过</button>
          <button size="mini" class="mini-btn" data-id="{{item._id}}" data-pass="{{false}}" bindtap="reviewTeacherApplication">拒绝</button>
        </view>
      </view>
    </view>

    <view class="desc" wx:else>暂无待审批申请</view>
  </view>
</view>
