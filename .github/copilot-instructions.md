# Copilot Instructions for CourseManage

## 语言与沟通
- 默认使用中文回复。
- 先给结论，再给关键变更点。
- 非必要不长篇解释，优先可执行步骤。

## 项目基线（必须遵守）
- 所有产品/权限相关改动必须遵循 [docs/product_spec.md](docs/product_spec.md)。
- 数据库与索引相关改动必须同步更新：
  - [docs/database_init.md](docs/database_init.md)
  - [docs/index_checklist.md](docs/index_checklist.md)
- 不得绕过云函数直接在前端写入敏感数据。

## 角色与权限规范
- 真实角色以 `users.role` 为准（server-side）。
- 生效身份 `activeRole` 仅用于前端视图切换，不可替代后端鉴权。
- 所有管理动作（审批、发布、批改、全量查询）必须在云函数二次鉴权。
- 新增角色能力时，前后端必须同时更新：
  - 前端显示与入口控制
  - 云函数权限判断与数据范围控制

## 菜单与信息架构规范
- 底部 Tab 固定：`首页 / 课程 / 作业 / 管理 / 我的`。
- `管理`：承载老师申请、审批列表、角色相关管理入口。
- `我的`：承载账户信息、身份切换、个人快捷入口，不放审批主流程。

## UI 设计规范
- 采用成熟管理系统风格：中性灰阶 + 低饱和主蓝。
- 避免高饱和渐变、大面积强对比背景。
- 列表页优先信息分层与可读性：表头、字段对齐、明确操作区。
- 任何新页面需复用现有全局样式令牌，不随意新增品牌色。

## 编码与变更要求
- 以最小改动解决问题，不改无关代码。
- 新功能优先复用现有工具函数与云函数 action 风格。
- 变更后至少做一次错误检查（lint/语法/运行时关键路径）。
- 涉及流程调整时，补充简短文档说明与验证步骤。

## 云开发约束
- 云函数统一入口：`cloudfunctions/core/index.js`。
- 新增 action 时：
  - 在 `switch(action)` 注册
  - 明确 success/fail 返回格式
  - 按需记录审计日志（不阻断主流程）
- 依赖环境切换时，优先使用动态环境，避免硬编码错误 `envId`。

## 禁止事项
- 不把本地私有配置（如 `project.private.config.json`）提交到仓库。
- 不在前端实现可绕过的“伪权限控制”。
- 未经确认不删除已有业务能力或已有页面入口。
