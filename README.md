# 课程管理助手小程序（微信原生 + 云开发）

本项目已实现：

- 行程收集（参与课程、房间数量/房型、到达时间、交通与车次/航班）
- 资料存档（上传 Word 文档到云存储并入库）
- 积分/学分查询
- 作业管理（教师发布、学生提交、教师批改并展示结果）
- 课程展示（课程安排、规则说明、温馨提示）
- 个人考勤（学生查看自己的出勤记录）
- 现场签到（定位签到 / 签到码签到）
- 用户登录与权限隔离（学生仅看本人数据；教师可管理课程、作业、签到）
- 角色流程：手机号命中管理员名单自动成为 admin；学生可申请成为老师，由 admin 审批
- 管理员可在“我的”页身份切换当前生效身份（学生/老师/管理员）
- 底部菜单重构为：首页 / 课程 / 作业 / 管理 / 我的（审批列表与老师申请统一在“管理”）
- UI风格：采用成熟管理系统风格（中性灰阶 + 低饱和主蓝 + 清晰层级）
- 审计日志：管理员审批、作业发布/批改、手机号绑定都会记录到 `audit_logs`

## 项目结构

- `miniprogram/`：小程序前端
- `cloudfunctions/core/`：统一业务云函数
- `docs/database_init.md`：数据库初始化说明
- `docs/product_spec.md`：产品规范（后续维护基线）

## 快速启动

1. 安装微信开发者工具。
2. 导入项目根目录（包含 `project.config.json`）。
3. 在 `miniprogram/app.js` 将 `envId` 修改为你的云开发环境 ID。
4. 打开“云开发”并创建环境。
5. 右键 `cloudfunctions/core` -> “上传并部署：云端安装依赖”。
6. 按 `docs/database_init.md` 创建集合；管理员手机号在 `miniprogram/app.js` 的 `adminProfiles` 中配置（默认包含 `17611681866`）。
7. 编译运行小程序。

## 发布部署步骤（生产）

1. **准备资质**
   - 完成小程序账号认证。
   - 在小程序后台配置合法域名（如有外部服务）。

2. **环境配置**
   - 创建生产云开发环境（建议与测试环境分离）。
   - 修改 `miniprogram/app.js` 中 `envId` 为生产环境 ID。

3. **数据库与存储**
   - 按文档创建集合；索引请参考 `docs/index_checklist.md`。
   - 配置云存储目录权限策略（`materials/`、`homework/`）。

4. **部署云函数**
   - 在开发者工具部署 `cloudfunctions/core`。
   - 通过云函数调用测试 `login/getCourseInfo/signIn` 等关键 action。

5. **小程序提审**
   - 点击“上传”，填写版本号与项目备注。
   - 在微信公众平台提交审核，补充隐私说明（定位用途：现场签到）。

6. **发布上线**
   - 审核通过后发布版本。
   - 观察云开发监控（调用量、错误率、数据库读写）。

## 建议的后续增强

- 教师端增加“行程总览统计”与“签到导出”
- 作业批改增加附件预览与批量打分
- 增加课程分班与多课程维度管理
